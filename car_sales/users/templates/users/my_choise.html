{% extends "main/base.html" %}
{% load static %}
{% load humanize %}
{% block title %}Обрані автомобілі - AutoSale{% endblock %}

{% block content %}
<!-- Favorites Header Section -->
<section class="favorites-header">
    <div class="container">
        <div class="favorites-header-content">
            <div class="favorites-title">
                <span class="material-icons">favorite</span>
                <h1>Обрані автомобілі</h1>
            </div>
            <p class="favorites-count">Всього обраних: <span>{{ page_obj.paginator.count }}</span></p>
        </div>
    </div>
</section>

<!-- Favorites Section -->
<section class="favorites-section">
    <div class="container">
        {% if page_obj %}
            <div class="cars-grid">
                {% for car in page_obj %}
                <div class="car-card">
                    <div class="car-image">
                        <div class="placeholder-image">
                            {% if car.image %}
                                <img src="{{car.image.url}}" alt="" class="card-image">
                            {% elif car.images.first %}
                                <img src="{{car.images.first.image.url}}" alt="" class="card-image">
                            {% endif %}
                        </div>
                        {% if car.is_sold %}
                            <div class="car-badge">ПРОДАНО</div>
                        {% else %}
                            <div class="car-badge new">АКТИВНЕ</div>
                        {% endif %}
                    </div>
                    <div class="car-info">
                        <a href="{{ car.get_absolute_url }}">
                            <h3>{{car.brand}} {{car.model}} {{car.year}}</h3>
                        </a>
                        <p class="car-details">{{car.color}} • {{car.mileage|intcomma}} км</p>
                        <p class="car-price">${{car.price|intcomma}}</p>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div class="car-location">
                                <span class="material-icons">location_on</span>
                                {{car.region}}
                            </div>
                            <div class="car-actions">
                                <form method="POST" action="{% url 'users:del_like' car.slug %}" style="margin: 0;" onsubmit="return confirm('Ви впевнені, що хочете видалити це оголошення?');">
                                    {% csrf_token %}
                                    <button type="submit" class="delete-icon" title="Видалити">
                                        <span class="material-icons">delete</span>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
            </div>

            <!-- Pagination -->
            {% if page_obj.paginator.num_pages > 1 %}
                <ul class="pagination">
                    <li class="{% if not page_obj.has_previous %}disabled{% endif %}">
                        <a href="{% if page_obj.has_previous %}?page={{ page_obj.previous_page_number }}{% endif %}">Previous</a>
                    </li>
                    {% for page in page_obj.paginator.page_range %}
                        {% if page >= page_obj.number|add:-2 and page <= page_obj.number|add:2 %}
                            <li>
                                <a href="?page={{ page }}" class="{% if page_obj.number == page %}disabled{% endif %}">{{ page }}</a>
                            </li>
                        {% endif %}
                    {% endfor %}
                    <li class="{% if not page_obj.has_next %}disabled{% endif %}">
                        <a href="{% if page_obj.has_next %}?page={{ page_obj.next_page_number }}{% endif %}">Next</a>
                    </li>
                </ul>
            {% endif %}
        {% else %}
            <!-- Empty State -->
            <div class="empty-favorites">
                <div class="empty-favorites-content">
                    <span class="material-icons empty-icon">favorite_border</span>
                    <h2>Список обраних порожній</h2>
                    <p>Ви ще не додали жодного автомобіля до обраних. Почніть додавати автомобілі, які вам подобаються!</p>
                    <a href="{% url 'main:main' %}" class="btn-primary">
                        <span class="material-icons">search</span>
                        Переглянути автомобілі
                    </a>
                </div>
            </div>
        {% endif %}
    </div>
</section>
{% endblock %}